const express = require("express");

const app = express();


app.use(express.json())

const connectToDB = require("./src/DB/db");
const NoteModel = require("./src/models/note.model"); //importing the NoteModel from the note.model.js file
const { connect } = require("mongoose");

connectToDB(); //calling the function to connect to the database


app.post("/notes",async (req,res)=>{
    /*
    ðŸ‘‰ à¦à¦‡ async keyword à¦¬à¦²à¦›à§‡:
    â€œà¦à¦‡ function-à¦à¦° à¦­à¦¿à¦¤à¦°à§‡ asynchronous à¦•à¦¾à¦œ (à¦¯à§‡à¦®à¦¨ database query) à¦¹à¦¬à§‡ â€” à¦¤à¦¾à¦‡ à¦†à¦®à¦¿ promise handle à¦•à¦°à¦¤à§‡ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤!â€
    ðŸ“Œ Express route handler-à¦ async à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦²à§‡ à¦¤à§à¦®à¦¿ await keyword à¦‡à¦‰à¦œ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‹ function à¦à¦° à¦­à¦¿à¦¤à¦°à¥¤
   */
    const {title,content}= req.body; /*ðŸ‘‰ à¦à¦Ÿà¦¾ à¦¹à¦²à§‹ object destructuring â€” à¦®à¦¾à¦¨à§‡ à¦¤à§à¦®à¦¿ req.body à¦…à¦¬à¦œà§‡à¦•à§à¦Ÿ à¦¥à§‡à¦•à§‡ title à¦†à¦° content à¦¨à¦¾à¦®à§‡à¦° à¦¦à§à¦‡à¦Ÿà¦¾ key à¦†à¦²à¦¾à¦¦à¦¾ à¦•à¦°à§‡ à¦«à§‡à¦²à¦›à§‹à¥¤ */
  /**
   ðŸŽ à¦•à¦²à§à¦ªà¦¨à¦¾à¦° à¦ªà§à¦¯à¦¾à¦•à§‡à¦Ÿ analogy:
   à¦§à¦°à§‹ à¦¤à§‹à¦®à¦¾à¦° à¦¹à¦¾à¦¤à§‡ à¦à¦•à¦Ÿà¦¾ à¦ªà§à¦¯à¦¾à¦•à§‡à¦Ÿ (ðŸ“¦) à¦†à¦›à§‡, à¦¯à¦¾à¦° à¦­à§‡à¦¤à¦°à§‡ à¦²à§‡à¦–à¦¾ à¦†à¦›à§‡ à¦à¦‡à¦¸à¦¬ à¦¤à¦¥à§à¦¯:
   {
  "title": "My First Note",
  "content": "Backend is fun!",
  "author": "Taiyeba",
  "views": 500
   }
  à¦à¦–à¦¨ à¦¤à§à¦®à¦¿ à¦¬à¦²à¦²à§‡:
  â€œà¦†à¦®à¦¿ à¦¶à§à¦§à§ title à¦†à¦° content à¦šà¦¾à¦‡â€”à¦¬à¦¾à¦•à¦¿à¦Ÿà¦¾ à¦†à¦®à¦¾à¦° à¦¦à¦°à¦•à¦¾à¦° à¦¨à§‡à¦‡à¥¤â€

   */
    console.log(title,content);

    await NoteModel.create({
        /*
        ðŸ‘‰ à¦à¦‡ await keyword à¦¬à¦²à¦›à§‡:

        â€œà¦†à¦®à¦¿ NoteModel.create() à¦à¦° result à¦†à¦¸à¦¾ à¦ªà¦°à§à¦¯à¦¨à§à¦¤ à¦…à¦ªà§‡à¦•à§à¦·à¦¾ à¦•à¦°à¦¬à§‹, à¦¤à¦¾à¦°à¦ªà¦° à¦ªà¦°à§‡à¦° à¦²à¦¾à¦‡à¦¨ à¦šà¦¾à¦²à¦¾à¦¬à§‹à¥¤â€
        ðŸ“Œ à¦à¦–à¦¾à¦¨à§‡ NoteModel.create() MongoDB-à¦¤à§‡ async insertion à¦•à¦°à§‡ â†’ à¦à¦Ÿà¦¾ promise return à¦•à¦°à§‡ await à¦¦à¦¿à§Ÿà§‡ à¦¤à§à¦®à¦¿ async à¦•à¦¾à¦œà¦•à§‡ sync-à¦° à¦®à¦¤à§‹ handle à¦•à¦°à¦›à§‹, à¦¯à¦¾à¦¤à§‡ error à¦¬à¦¾ race condition à¦¨à¦¾ à¦¹à¦¯à¦¼

        ðŸŽ Analogy (Taiyeba-style ðŸ˜‰):
            async function à¦®à¦¾à¦¨à§‡: à¦¤à§à¦®à¦¿ à¦à¦•à¦Ÿà¦¾ à¦°à§‡à¦¸à§à¦¤à§‹à¦°à¦¾à¦à¦° waiter â€” à¦¤à§à¦®à¦¿ à¦œà¦¾à¦¨à§‹ à¦•à¦¿à¦›à§ à¦–à¦¾à¦¬à¦¾à¦° à¦¤à§ˆà¦°à¦¿à¦¤à§‡ à¦¸à¦®à¦¯à¦¼ à¦²à¦¾à¦—à¦¬à§‡

            await à¦®à¦¾à¦¨à§‡: à¦¤à§à¦®à¦¿ à¦¬à¦²à¦›à§‹ "à¦à¦‡ à¦–à¦¾à¦¬à¦¾à¦°à¦Ÿà¦¾ à¦†à¦¸à§à¦•, à¦¤à¦¾à¦°à¦ªà¦° à¦ªà¦°à§‡à¦° à¦…à¦°à§à¦¡à¦¾à¦° à¦¨à§‡à¦¬!"

        */
        title,
        content
    })

    res.json({
        title,content 
    })

})

app.delete("/notes/:id", async(req,res)=>{

    const noteId =req.params.id

    await NoteModel.findByIdAndDelete({
        _id : noteId
    });

    res.json({
        messege: "Note deleted successfully",
        
    })
})

app.patch("/notes/:id", async(req,res)=>{
    const noteId = req.params.id;
    const {title} =req.body;

    await NoteModel.findByIdAndUpdate({
        _id: noteId
    },{
        title:title
    });

})


app.get("/notes", async (req, res) => {
  const notes = await NoteModel.find();
  res.json({
    message: "Notes fetched successfully",
     notes
  });
});


app.get("/",(req,res)=>{
    res.send("Hello, World!");
    data: notes
})

app.listen(3000,()=>{
    console.log("Server is running on port 3000");
})